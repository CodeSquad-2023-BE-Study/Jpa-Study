# ê°’ íƒ€ì…ê³¼ ë¶ˆë³€ ê°ì²´

## ê°’ íƒ€ì… ê³µìœ  ì°¸ì¡° ì£¼ì˜!

- ê°™ì€ ê°’íƒ€ì…ì„ ì—”í‹°í‹°ë¼ë¦¬ ê³µìœ í•  ê²½ìš° í•œìª½ ì—”í‹°í‹°ê°€ ìˆ˜ì •ë˜ë©´ ê°’íƒ€ì…ì´ ê°™ì´ ìˆ˜ì •ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

```java
@Getter
@NoArgsConstructor
@Embeddable
public class PayDetails {
    **public static final PayDetails EMPTY = new PayDetails();** // ì „ì—­ ë³€ìˆ˜
```

- ì‰½ê²Œ ìƒìˆ˜ ì‚¬ìš© ê¸ˆë¬¼! [ì°¸ê³ ë§í¬](https://jojoldu.tistory.com/559)

```java
location = new ConnectedLocation(100, 200);
**member** = Member.builder()
        .name("ìƒˆí˜")
        .connectedLocation(location)
        .connectedHistory(List.of(location))
        .build();

Member member2 = Member.builder()
        .name("ë¸Œë£¨ë‹ˆ")
        .connectedLocation(location) // ê°™ì€ ë¡œì¼€ì´ì…˜ì„ ì°¸ì¡°í•©ë‹ˆë‹¤.
        .build();
em.persist(member2);

Coordinates connectedLocation = member2.getConnectedLocation();
connectedLocation.changeX(500);
```

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/771e9d4d-cfa7-4d88-803c-65a12e76aa15/Untitled.png)

- ê·¸ë˜ì„œ ê°’ê°ì²´ëŠ” ë¶ˆë³€ê°ì²´ë¡œ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.

```java
Member member2 = Member.builder()
        .name("ë£¨ë¯¸ë‘")
        .connectedLocation(new ConnectedLocation(location.x(), location.y())) // ìƒˆë¡œ ìƒì„±í•˜ê±°ë‚˜
        .build();

Member member2 = Member.builder()
                .name("ë£¨ë¯¸ë‘")
                .connectedLocation(location.clone()) // cloneí•´ì„œ ìƒˆë¡œìš´ ê°ì²´ë¡œ ë§Œë“­ë‹ˆë‹¤.
                .build();
```

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d3e621b2-dc62-4e30-8bac-c7d2e2b9f9ae/Untitled.png)

## ê°’ íƒ€ì…ì˜ ë¹„êµ

> ***`Entity`, `ValueObject` ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?***
> 
- `Value Object`ëŠ” **ê°’**ì— ì˜í•´ ë™ë“±ì„±ì´ íŒë‹¨ë˜ëŠ” ê°ì²´. ê¸°ë³¸ì ìœ¼ë¡œ ë¶ˆë³€ì…ë‹ˆë‹¤.
    - ì‹ë³„ìë¥¼ ê°€ì§€ì§€ ì•ŠëŠ”ë‹¤. ê°€ì§ˆ í•„ìš”ê°€ ì—†ë‹¤. ê°’ìœ¼ë¡œ ì‹ë³„í•˜ë‹ˆê¹Œ
    - **ê°’ìœ¼ë¡œ ë™ë“±ì„±ì„ íŒë‹¨í•´ì•¼í•˜ê¸° ë•Œë¬¸ì— ë°˜ë“œì‹œ equalsì™€ hashë¥¼ êµ¬í˜„í•´ì¤ë‹ˆë‹¤.**
- `Entity`ëŠ” ì‹ë³„ìë¥¼ ê°€ì§„ë‹¤. **ì‹ë³„ìë¡œ ë™ë“±í•¨ì„ íŒë‹¨**í•©ë‹ˆë‹¤.
    - ì¦‰, ë‹¤ë¥¸ ë°ì´í„°ì´ì§€ë§Œ ê°™ì€ ê°’ì„ì„ ê°ì§€í•  ìˆ˜ ìˆê³ , ë³€í™”í–ˆìŒì„ ê°ì§€í•  ìˆ˜ ìˆë‹¤.
    - ê°ì²´ëŠ” ê°™ë˜ ê·¸ ì•ˆì— ì†ì„±ì„ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.

<aside>
ğŸ’¡ **ì—”í‹°í‹°ì™€ ê°’ê°ì²´ì˜ ì°¨ì´ì ì„ ì•Œ ìˆ˜ ìˆëŠ” ì˜ˆì œ**

ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í†µí•´ í˜„ì¬ ìœ„ì¹˜ë¥¼ ì¶”ì í•  ìˆ˜ ìˆë‹¤ê³  ê°€ì •í•´ ë³´ê² ìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì¸í„°ë„·ì— ì„±ê³µì ìœ¼ë¡œ ì—°ê²°í•˜ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ì¸ì¦í•˜ë©´ ìƒˆ ìœ„ì¹˜ ê°œì²´ê°€ ìƒì„±ë©ë‹ˆë‹¤. ì´ Location ê°ì²´ì—ëŠ” ê²½ë„ì™€ ìœ„ë„ì— ëŒ€í•œ ì†ì„±ì´ ìˆìŠµë‹ˆë‹¤. ìœ„ì¹˜ ê°ì²´ëŠ” ê°’ ê°ì²´ì´ë¯€ë¡œ ê°ì²´ì˜ íŠ¹ì • ì¸ìŠ¤í„´ìŠ¤ëŠ” ì‹ ê²½ ì“°ì§€ ì•Šê³  ìœ„ì¹˜ë¼ëŠ” ê²ƒë§Œ ì‹ ê²½ ì“°ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ì‚¬ëŒì´ ìœ„ì¹˜ë¥¼ ë³€ê²½í•˜ë©´ ìœ„ì¹˜ ê°œì²´ë¥¼ ì—…ë°ì´íŠ¸í•  í•„ìš” ì—†ì´ ìƒˆ ìœ„ì¹˜ ê°œì²´ë¥¼ ë§Œë“¤ë©´ ë©ë‹ˆë‹¤.

- [ì¶œì²˜](https://culttt.com/2014/04/30/difference-entities-value-objects)

</aside>

# ê°’íƒ€ì… ì»¬ë ‰ì…˜

```java
@Entity
@Getter
@NoArgsConstructor
public class Member {
    @Id @GeneratedValue(strategy = GenerationType.AUTO)
    private Long id;
    private String name;

    @Embedded
    private Coordinates connectedLocation;

    @ElementCollection(fetch = FetchType.EAGER) // 1:Nê´€ê³„ì…ë‹ˆë‹¤.
    @CollectionTable(name = "location_history", joinColumns = @JoinColumn(name = "member_id"))
    private List<ConnectedLocation> connectedHistory = new ArrayList<>();

		// ê¸°íƒ€ ë“±ë“±
}
```

- ì—°ê´€ëœ ë¶€ëª¨ Entity í•˜ë‚˜ì—ë§Œ ì°¸ì¡°ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ë…ë¦½ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
- ì§€ì—°ë¡œë”© ì „ëµì„ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
- ì˜ì†ì„± ì „ì´ + ê³ ì•„ ê°ì²´ ì œê±° ê¸°ëŠ¥ì„ ê°€ì§‘ë‹ˆë‹¤.
- ì£¼ì˜í•  ê²ƒ!
    - ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì˜ ë³€ê²½ì‚¬í•­ì´ ì¼ì–´ë‚˜ë©´ í•´ë‹¹ ë°ì´í„°ë¥¼ ëª¨ë‘ ì§€ìš°ê³  ë‹¤ì‹œ ë“±ë¡í•©ë‹ˆë‹¤.
    - ì‹ë³„ìê°€ ì—†ìœ¼ë¯€ë¡œ ê°’ì„ ë¹„êµí•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
    - addë¥¼ ì‚¬ìš©í•˜ë‹ˆ ë‹¤ìŒê³¼ ê°™ì€ ì˜ˆì™¸ê°€ ë‚¬ìŠµë‹ˆë‹¤.

```java
java.lang.UnsupportedOperationException
	at java.base/java.util.ImmutableCollections.uoe(ImmutableCollections.java:142)
	at java.base/java.util.ImmutableCollections$AbstractImmutableCollection.add(ImmutableCollections.java:147)
	at org.hibernate.collection.spi.PersistentBag.add(PersistentBag.java:391)
	at com.example.jpapractice.week5.valueObject.domain.Member.addLocationHistory(Member.java:42)
	at com.example.jpapractice.week5.valueObject.domain.MemberTest.elementalCollectionTest(MemberTest.java:91)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
```

```java
ConnectedLocation coordinates = new ConnectedLocation(500, 500);
        List<ConnectedLocation> newList = new ArrayList<>(); // ë¹ˆ ë¦¬ìŠ¤íŠ¸ ìƒì„±

        // newListì— ê¸°ì¡´ ìš”ì†Œë¥¼ ì¶”ê°€
        newList.addAll(member.getConnectedLocations().stream()
                .map(ConnectedLocation::clone).toList()); // í´ë¡ í•´ì„œ ë‹¤ì‹œ ë„£ì–´ì¤˜ì•¼ í•©ë‹ˆë‹¤.

        newList.add(coordinates.clone()); // ìƒˆ ìš”ì†Œ ì¶”ê°€
        member.updateConnectedHistory(newList);

        em.flush();

        assertThat(member.getConnectedLocations()).hasSize(2);
```

```java
Hibernate: delete from location_history where member_id=?
Hibernate: insert into location_history (member_id,latitude,longitude) values (?,?,?)
Hibernate: insert into location_history (member_id,latitude,longitude) values (?,?,?)
```

- ë¶€ëª¨ Entity Idì™€ ì¶”ê°€ ì»¬ëŸ¼(basic or embedded íƒ€ì…)ìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.

---

# Refs.

- [JPA ì‚¬ìš©ì‹œ @Embedded ì£¼ì˜ì‚¬í•­](https://jojoldu.tistory.com/559)
- [What is the difference between Entities and Value Objects? | Culttt](https://culttt.com/2014/04/30/difference-entities-value-objects)
